# 如何审计你的 Python 代码的质量:一步一步的指南(里面有免费的清单和样本报告)

> 原文：<https://www.stxnext.com/blog/how-to-audit-the-quality-of-your-python-code>

 构建一个软件开发项目有点像一个叠人偶游戏。

所有的元素创造了一座完美的塔。通常，它可能会被调整和工作，没有任何后果。但是如果它有一个脆弱的地方，一个错误的举动可能会毁掉所有的努力。

好吧，这不是一个完美的类比。一个软件程序比一堆木块需要更多的工作，我们不一定要把它的部分去掉，而是添加下一部分。

然而,“捅一捅，所有人都会倒下”的比喻仍然成立。 **如果你的项目有任何弱点，它们可能会毁灭整个建设。**

如果你使用的工具已经过时并可能导致严重的安全漏洞，那么你的代码写得再好也没有用。您的产品处理的敏感数据越多，您就必须越小心。

代码审计对于确保你的产品质量好、安全、随时可以发布是至关重要的。

在这篇文章中，你会发现一个详细的指南，关于什么是代码审计，为什么你需要它，以及如何一步一步地执行它。 [作为一家以 Python 为中心的软件公司，](https://stxnext.com/what-is-python-used-for/) 我们决定把重点放在如何对基于 Python 的代码进行审计上。然而，无论您选择哪种技术，您都会发现一些相关的提示和指南。

我们还将为您提供一份清单和一份审计报告样本，让您了解一个准备充分、全面的审计流程是什么样的。示例性审计长达 20 多页，将成为您未来工作的绝佳参考点！[在此下载清单和报告样本](/code-audits/python/)！

在我们的指导下，你将能够自己运行 Python 代码审计，并了解你应该从审计中得到什么。 读下去！ 

#### 什么是代码审计？

**“代码审计(Code audit)是对一个编程项目中的源代码进行综合分析，目的是发现 bug、安全漏洞或违反编程约定的行为，”** 根据维基百科。我知道在一篇文章中引用维基百科就像在婚礼致辞中引用韦氏词典——但这次他们做得太对了，值得表扬！

**每一次代码审计的目的都是确保给定的程序是:**

*   安全，
*   没有错误和缺陷，
*   易于维护和进一步处理，
*   根据当前的标准，
*   符合编码最佳实践。

跳过其中的任何一个，你就牺牲了代码的质量和安全性，这可能——很可能会——带来灾难性的后果。 糟糕的文档和技术债务可能会减缓甚至停止你的项目；错误和安全漏洞可能会让你失去客户、声誉和良好的用户评级。这仅仅是开始。

通过代码审计，你可以确保你的代码是安全的，没有错误的，并且可以交付使用。

##### 代码审计与代码评审

读完上面的部分，你可能会想:好吧，但是你刚刚描述的一切都可以在代码审查的帮助下实现，我们定期运行这些！

诚然，这些术语有时可能会互换使用，但它们之间有一些微妙的差异。

代码评审包含在一个团队中——开发人员评审彼此的代码，他们只关注一个特定的部分。

另一方面，代码审计总是关注整个项目，并由团队之外的人执行——可以是其他开发人员，甚至是外部公司。

虽然代码审查是有用的和必要的，但是每隔一段时间进行一次代码审查会有很大的不同。 让我在这里用另一个比喻:评论就像检查你的汽车的不同部分的潜在故障。当然，有必要看看前灯是否正常工作，两个雨刷是否都正常，你的刹车是否正常工作……但是除非你发动汽车，开车兜风，并评估一切是如何一起工作的，否则你不会知道整个机器实际上有多好。

不成文的规则是，越多的人看到你的代码越好。 你修复得越多，项目从长远来看执行得越完美。

在有限的时间内，我们可以为您运行免费的代码审计。我们的高级开发人员将帮助发现任何潜在的问题，就如何修复它们提出建议，并就如何提高代码的质量和可维护性向您提供建议。

优惠是有限的，所以代码审计是在“先到先得”的基础上提供的。

***[到这里来](https://stxnext.com/services/code-audit)安排下一次 STX 的免费代码审计。***

#### 什么时候可以从代码审计中受益？

**您可能会发现自己需要在许多不同的开发阶段和不同的情况下运行代码审计:**

*   在将你的产品推向市场之前，额外确保质量无可挑剔，你不会第二天醒来看到一堆一星评价；
*   **继承遗留代码后，** 帮助你规划未来的工作，评估项目的范围、成本和时间框架；
*   **在你投资一个项目之前，** 验证它是否是一个好的赌注；
*   **每当你觉得自己的产品次优的时候。** 也许是[应用的滞后](/stx-new-blog/web-app-speed-website-performance/)，或者有一些太多的 bug 需要忽略？检查代码并应用更改永远不会太晚。

#### 代码审计的好处

代码审计有许多不同的目的。它们都取决于你的立场。

**从一个开发者的角度来看，你获得了以下优势:**

*   如上所述， **越多人看到你的代码越好。** 如果你的产品经过了全面的检查，任何潜在的错误和漏洞都有可能在发布前被发现，你可以毫无压力地修复它们。更不用说它会帮助你睡得很香，知道所有的工具都是最新的，并遵循最大的安全协议。
*   **同一个团队的开发人员从头到尾都在开发同一个产品的情况非常罕见。**同事可能会改变，有时[一两个外包团队可能会加入工作](https://stxnext.com/blog/2018/08/14/how-manage-your-outsourced-development-team/)，开发人员的总数可能会增加或减少。此外，源代码的每个部分都是由具有不同技能和能力的不同人员编写的。

    这就是为什么每次你得到你以前没有处理过的源代码时，执行一次审计是明智的(例如，我们通常在开始处理之前，对从客户那里收到的代码进行一次内部审计)。它将帮助您评估您的工作范围、总体质量和可维护性。
*   **审计将帮助你避免技术债务。** 相信我，“那是未来我的问题”对于软件开发来说并不是一个好方法。

**作为组长，你会发现:**

*   自己执行代码审计，或者至少参与其中，会让你对整个项目有一个大致的了解。 通常，团队领导不会每天都看到代码，因此审计将帮助他们熟悉项目的当前状态、结构和功能。

**而从严格的商业角度来看，你得到了以下优势:**

*   审核有助于证明您的计划已经准备好推出并介绍给您的客户和顾客。 故障或安全漏洞可能会让你损失一大笔钱——还有你的声誉。
*   **一个最新的、新鲜的、与技术相关的项目对开发者来说更有吸引力。** 优质的代码会吸引高素质的人才！

*   **经过审计的代码有助于简化开发过程，** 这反过来意味着工作可以在更少的阻碍下进展得更快。

#### Python 代码审计:分步指南和清单

**在本节中，我们将逐步介绍如何运行 Python 代码审计。**

每一小节都详细描述了代码审计的关键元素。它会给你一个如何组织文档的想法。

我们还包括了如何确保您从一开始就遵循最佳实践的提示。您甚至可以在审计之前应用它们！

**要查看最终结果应该是什么样子，[参考我们在这个免费 PDF 中提供的例子](/code-audits/python/)。它有 20 多页长，基于我们执行的真实代码审计。**

我们开始吧！

##### 1.代码库

一开始，**检查跟踪并提供对源代码** (例如 GIT)的更改的版本控制系统是很重要的。验证它是否维护良好。

**提示:** 考虑根据 [Gitflow 工作流](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow)进行工作，该工作流“规定了建立什么样的分支以及如何将它们合并在一起。”注意分支的正确名称。如果你的产品特别大，考虑使用合适的 Git 标签。它使得管理一个更大的项目变得非常容易。

##### 2.软件体系结构

##### **a)技术选择**

本节的重点是验证技术堆栈是否是项目的最佳选择，以及它是否具有内部兼容性。

当您开始验证技术选择时， **第一步应该是检查所有使用的应用程序是否根据 LTS 版本命名，以及它们是否是最新的。**

**接下来，是时候判断所有组件是否[都经过良好测试](/stx-new-blog/how-can-your-software-benefit-automated-testing/)以及它们是否相互匹配了。**

在实践中意味着什么？例如，[Django](/stx-new-blog/how-can-your-software-benefit-automated-testing/)apps[与 Postgres](https://stackoverflow.com/questions/9540154/which-database-engine-to-choose-for-django-app/9540312) 一起使用比与 MySQL 等其他数据库引擎一起使用更频繁。虽然不太受欢迎的选择不一定在技术上更弱，但选择它们将大大减少您寻求任何潜在问题帮助的机会。

为了评估项目的可持续性，必须考虑到这些方面。

##### **b)部署配置**

检查  **哪些服务用于支持应用程序总是值得的。** 你要注意提供托管服务的软件(uwsgi、gunicorn、nginx)和托管方式(无论是云端还是本地)。

**提示:** 没有明确的答案哪种方法是对的——每种托管类型都有其优缺点。一切都取决于你所从事的项目的类型。

不过，我真心推荐云托管。它不仅能帮你省钱(不需要关心硬件，更少的维护，更高的生产力)，而且你还能获得更高的应用可用性。大多数云提供商的报价超过[99.99%](https://kinsta.com/blog/google-cloud-vs-aws/#uptime)！

**下一步是验证应用是否包含负责项目虚拟化的文件。**

**提示:**我强烈建议使用[码头工人](https://www.docker.com/)。它允许在开发阶段解决许多潜在的问题和错误，因为开发版本在与产品版本相同的环境中运行。

**接下来，就该检查自述文件是否包含所有必需的元素了:**

*   配置说明，
*   安装说明，
*   用户手册，
*   清单文件(带有附加的文件列表)，
*   关于版权和许可证的信息，
*   分销商和开发商的详细联系信息，
*   已知的错误和故障，
*   问题解决部分，
*   变更日志(面向开发人员)。

在修改您的项目目录时， **您应该检查它是否包括负责持续集成和部署(CI/CD)的文件。**

**提示:** 建设良好的 CI/CD 管道可以让您的项目受益匪浅。它们提供了一种更有效的构建程序的方式，但是它们也包含了在代码构建期间负责测试应用程序和验证其有效性的脚本。

**检查项目配置，验证是否不包含任何第三方可以找到的密码。【T2**

**提示:** 建议将运行应用程序所需的所有登录和密码保存在环境变量中——无论是在运行应用程序的机器上还是在负责 CI/CD 的工具中。

检查是否有一个错误跟踪系统。 其中最受欢迎的是  [哨兵。](https://sentry.io/welcome/)

##### 3.编码最佳实践

根据您使用的编程语言和包/库的不同，这一部分看起来会有所不同。

使用 Python，  **你需要仔细检查代码是否符合 PEP 8 风格指南和 PEP 257 docstring 约定。**

好消息是，您不必全部手动完成。在这个过程中，有一些工具可以帮助你。

##### **a)棉绒**

*   [皮拉玛](https://pylama.readthedocs.io/en/latest/)
*   [薄片 8](https://flake8.pycqa.org/en/latest/)

##### **b)其他独立工具**

*   [Pylint](https://www.pylint.org/)—Python 的源代码、bug 和质量检查器；
*   [py flakes](https://pypi.org/project/pyflakes/)—另一个 bug 检查器(只检查逻辑错误，不检查风格，但工作速度更快)；
*   [Pycodestyle](https://pypi.org/project/pycodestyle/)—对照 PEP 8 中的样式约定检查 Python 代码；
*   [Pydocstyle](https://pypi.org/project/pydocstyle/)—检查是否符合 Python 文档字符串约定；
*   [Bandit](https://pypi.org/project/bandit/)—发现 Python 代码中常见的安全问题；
*   MyPy—Python 的静态类型检查器。

##### c)代码分析和格式化工具

*   Mccabe—一个 Python 复杂性检查器；
*   [Radon](https://pypi.org/project/radon/)—从源代码中计算各种指标的 Python 工具；
*   [黑色](https://github.com/psf/black)—Python 代码格式化程序；
*   [Isort](https://github.com/timothycrosley/isort)—一个对导入进行排序的 Python 实用程序/库；
*   [Yapf](https://github.com/google/yapf)—一个 Python 格式化程序。

即使这些工具可以极大地自动化和加快你的工作， **为了找到任何潜力，手工分析代码仍然是值得的:**

*   虫子，
*   瓶颈，
*   性能问题，
*   安全漏洞，
*   与维护应用程序相关的危险。

##### 4.对未来的提示:如何确保代码的质量

代码审计可以帮助改进你的代码并消除任何现存的问题。

但是如果在运行代码审计时，觉得要改进的事情列表太长，  **试着熟悉一些好的实践。** 虽然不是所有的都适用于每一个团队，但这里有一些值得考虑:

*   每一段代码都应该由至少两个开发人员审查；
*   使用 githooks
*   为整个团队确定一个特定的格式化程序配置；
*   分享你的知识！无论是涉及到您所精通的技术，还是涉及到您所解决的任务，它都有助于团队采用相同的良好实践；
*   考虑要求团队成员使用相同的代码编辑器——这将有助于标准化。

#### 关于审计 Python 代码质量的最终想法

我们希望我们关于如何运行代码审计的指南能够帮助你自己执行审计，或者评估一个好的审计文档应该是什么样的。

**如果您想开始工作，我们建议您[下载我们的 PDF 文件](/code-audits/python/)—其中包含一份清单和一个真实的审计示例以供参考。**

在有限的时间内，我们再次提供**免费代码审计！**如果你想让你的代码得到零成本的专业审计，[点击这里安排你的 Python 审计](https://stxnext.com/services/code-audit)。

如果您想了解更多关于如何确保更好的代码质量的信息，为什么不查看以下资源:

*   [代码评审:把代码质量放在第一位](https://www.stxnext.com/blog/code-review/)
*   [如何审核你的 React 原生代码的质量:一个温和的介绍(免费的分步指南)](/blog/how-to-audit-the-quality-of-your-react-native-code/)
*   [软件测试&质量保证服务](https://www.stxnext.com/services/software-testing-and-quality-assurance/)

我们还能为你做些什么吗？请给我们写封短信，我们会尽快回复你！